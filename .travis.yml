language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: Y4vOFEMjbXyPKn1rMCiGdn7RzWQGZTWhRwGABIL2oET7vnn/8PK46dKxUuS3v0r1vcgPFLmD3peEVpD2V6v2SK8B6WGrucgLLTM8nnu87a+80Zp/O8gt1NJ1U//mOOJc4ERhBTa02vabpVNqwLYEBth1WqkvwUZKvfqiQfRR6yE6QV9kk1SKyLxy+r5W9VRdeaC1XJILBc9jCAgRdnzHUn6on7MigeqSn8rrZNQELk46hU3Aik2MDZdh48SBZl+HpKU8I2NGgSkNZnZpxqUYZX+SGRNQ90MMqkjHpMGbm6wXGNtSQRWjOcQZJC1czylUHCP2MP/lQ3HJDwoB+NWRzuqGm6+WIwabeMgRCp/eydA6I86/w2mHJIIkiPgkYpPSFk8FeJPXJAKI7nFewcpGeP/069EiRZMNh1gM7zKQbAdXiAXdGUKrapTCxP23y6DkXVmvQ/h74ZTeA0EAoTA+E50PTsqp1tfiylIPiYwIUglKSMEqYdW8fAhMIAyo6oxPUTV9hA0RrzXcaQDDWPA7Noe3OjNO5RUQTrKkJEBXc0VYdMo/MdO97w7s2QsLcvH4d0DroWPnHSw9jmRG44McQNpzkd07EhushQjGQE5a/TS5QY3iUtDVsEQCggPTCHk4lP+NZ8RYRg41soQ+vGV7Pib56Z/ZEH4B7S19DbR9sDQ=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
